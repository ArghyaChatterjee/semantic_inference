cmake_minimum_required(VERSION 3.0.2)
project(pytorch-download)

if(NOT EXISTS
   "@PYTORCH_CACHE_DIR@/libtorch-cxx11-abi-shared-with-deps-1.9.0%2Bcu111.zip")
  file(
    DOWNLOAD
    https://download.pytorch.org/libtorch/cu111/libtorch-cxx11-abi-shared-with-deps-1.9.0%2Bcu111.zip
    "@PYTORCH_CACHE_DIR@/libtorch-cxx11-abi-shared-with-deps-1.9.0%2Bcu111.zip")
endif()

add_custom_command(
  OUTPUT "@PYTORCH_OUTPUT_DIR@/libtorch/share/cmake/Torch/TorchConfig.cmake"
  COMMAND unzip -qo "libtorch-cxx11-abi-shared-with-deps-1.9.0%2Bcu111.zip" -d
          @PYTORCH_OUTPUT_DIR@
  DEPENDS
    "@PYTORCH_CACHE_DIR@/libtorch-cxx11-abi-shared-with-deps-1.9.0%2Bcu111.zip"
  WORKING_DIRECTORY @PYTORCH_CACHE_DIR@
  COMMENT "Unpacking pytorch"
  VERBATIM)

add_custom_target(
  pytorch_unpacking ALL
  DEPENDS "@PYTORCH_OUTPUT_DIR@/libtorch/share/cmake/Torch/TorchConfig.cmake")
